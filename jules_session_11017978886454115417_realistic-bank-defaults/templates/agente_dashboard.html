{% extends 'base.html' %}

{% block content %}
<h2>Agente Dashboard</h2>
<div class="card">
    <div class="card-header">All Boletos</div>
    <div class="card-body">
        <form action="{{ url_for('approve_boletos') }}" method="POST">
            <button type="submit" class="btn btn-success mb-3">Approve Selected (Ready for Remessa)</button>
            <a href="{{ url_for('generate_remessa') }}" class="btn btn-outline-dark mb-3">Download Remessa (.REM)</a>
            
            <table class="table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll"></th>
                        <th>Cedente</th>
                        <th>Sacado</th>
                        <th>Amount</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Lastros (Docs)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for boleto in boletos %}
                    <tr>
                        <td>
                            {% if boleto.status == 'printed' %}
                            <input type="checkbox" name="boleto_ids" value="{{ boleto.id }}">
                            {% endif %}
                        </td>
                        <td>{{ boleto.user.username }}</td>
                        <td>{{ boleto.sacado_name }}</td>
                        <td>{{ boleto.amount }}</td>
                        <td>{{ boleto.due_date }}</td>
                        <td>{{ boleto.status }}</td>
                        <td>
                            <!-- Show associated invoices/lastros -->
                             {% for inv in boleto.invoices %}
                                <div>
                                    <small>{{ inv.upload_type|upper }}</small>
                                    <a href="{{ url_for('view_lastro', invoice_id=inv.id) }}" target="_blank" class="text-decoration-none">View</a>
                                </div>
                             {% endfor %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center">No boletos found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</div>
<script>
    document.getElementById('selectAll').onclick = function() {
        var checkboxes = document.getElementsByName('boleto_ids');
        for (var checkbox of checkboxes) {
            checkbox.checked = this.checked;
        }
    }
</script>
{% endblock %}
